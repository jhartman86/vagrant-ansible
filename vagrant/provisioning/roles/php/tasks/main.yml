---
- name: Add PHP5 PPA repository
  apt_repository: repo=ppa:ondrej/{{ php_ppa }}

- name: Update apt cache
  apt: update_cache=yes

- name: Install PHP5
  apt: pkg=php5 state=latest

- name: Install PHP5-cli
  apt: pkg=php5-cli state=latest

- name: Install PHP packages
  apt: pkg={{ item }} state=latest
  with_items: php_packages

- name: Install Composer
  shell: curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin creates=/usr/local/bin/composer

- name: Rename composer.phar to composer
  shell: mv /usr/local/bin/composer.phar /usr/local/bin/composer creates=/usr/local/bin/composer

- name: Make composer executable
  file: path=/usr/local/bin/composer mode=a+x state=file

# PHP Configuration
- name: Enable short_open_tags in php.ini
  lineinfile: dest=/etc/php5/apache2/php.ini regexp="{{ item.regexp }}" line="{{ item.line }}" backup=yes
  with_items:
    - { regexp: "short_open_tag =", line: "short_open_tag = On" }
  notify: restart_apache